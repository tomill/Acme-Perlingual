<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta http-equiv="imagetoolbar" content="no" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="width=device-width,initial-scale=1">

        <link rel="stylesheet" href="//static.koneta.org/base.css" type="text/css" />    
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=tomita"></script>

<style type="text/css" media="screen">
h1 {
    font-size: 200%;
}
.container {
    width: 1200px;
    min-height: 500px;
}
.input, .output {
    float: left;
    width: 580px;
}
.input {
    margin-right: 20px;    
}
.editor { 
    font-size: 20px;
    height: 350px;
    border: 1px solid silver;
    margin: 0 0 20px;
}
.output .ace_marker-layer,
.output .ace_cursor-layer {
    display: none;
}
.box {
    white-space: pre-wrap;
}
</style>

<script type="text/javascript">
function p2p() {
    var input = ace.edit('input').getValue();
    if (!input) return;

    function msg(area, message){
        $('.input .box, .output .box').hide();
        $(area).text(message).show();
    }

    $.ajax({
        type: 'POST',
        url: '/api',
        data: { input: input },
        dataType: 'json'
    }).done(function(data){
        if (data.errors) {
            msg('.output .error', data.errors.join(""));
        } else {
            msg('.output .success', 'No syntax errors detected :)');
        }
        
        ace.edit('output').setValue(data.output, 1);
    }).fail(function(e, txt){
        msg('.input .error', [ txt, '-', e.status, e.statusText ].join(" "));
    });
}

jQuery(function($){
    var ace_options = {
        theme: 'ace/theme/xcode',
        //showGutter: false,
        highlightActiveLine: false,
        displayIndentGuides: false
    };
    
    var input = ace.edit('input');
    input.setOptions(ace_options);
    input.getSession().setMode('ace/mode/perl');
    input.getSession().on('change', p2p);

    var output = ace.edit('output');
    output.setOptions(ace_options);
    output.setReadOnly(true);
    output.getSession().setMode('ace/mode/php');
});
</script>

        <title>Acme::P2P live test #sushi</title>
    </head>
    <body>
        <div class="container clear">
            <h1>Acme::P2P live test</h1>

            <div class="input">
                <h3>perl</h3>

<div class="editor" id="input">#!perl
if ($foo) {
    print "foo";
}
</div>
                
                <p class="error box hidden"></p>
            </div>

            <div class="output">
                <h3>php</h3>

<div class="editor" id="output">&lt;?php
if ($foo) {
    print("foo");
}
</div>
                
                <p class="success box hidden"></p>
                <p class="error box hidden"></p>
            </div>
        
        </div>
        
        <div class="footer grays clear">
            This is <a href="https://github.com/tomill/Acme-P2P">Acme::P2P</a> live test form
                for <a href="http://www.zusaar.com/event/9467003">suzuken's <img src="http://static.koneta.org/emoji/sushi.png" alt="sushi" class="emoticon">確認会</a>
                    / <a href="http://ajito.vg/">#ajiting</a>
                    <br>
            by <a href="http://e8y.net/about">tomita</a>
        </div>
        
        <hr class="blank">
        
        <div class="addthis_native_toolbox"></div>

    </body>
</html>
